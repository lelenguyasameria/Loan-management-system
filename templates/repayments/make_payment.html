{% extends 'base.html' %}

{% block title %}Make Payment - Loan Management System{% endblock %}

{% block content %}
<div class="card" style="max-width: 600px; margin: 2rem auto;">
    <h2>Make Payment for Loan #{{ loan.id }}</h2>
    
    <div class="card" style="background-color: #f8f9fa; margin-bottom: 2rem;">
        <h3>Loan Details</h3>
        <div class="grid grid-2">
            <div>
                <p><strong>Original Amount:</strong> ${{ loan.amount|floatformat:2 }}</p>
                <p><strong>Interest Rate:</strong> {{ loan.interest_rate }}%</p>
            </div>
            <div>
                <p><strong>Total Paid:</strong> ${{ total_paid|floatformat:2 }}</p>
                <p><strong>Remaining Balance:</strong> ${{ remaining_balance|floatformat:2 }}</p>
            </div>
        </div>
    </div>
    
    <form method="POST">
        {% csrf_token %}
        <div class="form-group">
            <label for="amount_paid">Payment Amount ($):</label>
            <input type="number" id="amount_paid" name="amount_paid" step="0.01" min="1" 
                   max="{{ remaining_balance }}" required>
            <small style="color: #666;">
                Minimum: $1.00, Maximum: ${{ remaining_balance|floatformat:2 }} (remaining balance)
            </small>
        </div>



        <div style="background-color: #e7f3ff; padding: 1rem; border-radius: 4px; margin: 1rem 0;">
            <h4>Quick Payment Options</h4>
            <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; margin-top: 0.5rem;">
                <button type="button" onclick="setAmount(50)" class="btn" style="font-size: 0.9rem;">$50</button>
                <button type="button" onclick="setAmount(100)" class="btn" style="font-size: 0.9rem;">$100</button>
                <button type="button" onclick="setAmount(250)" class="btn" style="font-size: 0.9rem;">$250</button>
                <button type="button" onclick="setAmount(500)" class="btn" style="font-size: 0.9rem;">$500</button>
                <button type="button" onclick="setAmount({{ remaining_balance|floatformat:2 }})" 
                        class="btn btn-success" style="font-size: 0.9rem;">Pay Full Amount</button>
            </div>
        </div>

        <button type="submit" class="btn btn-success" style="width: 100%;">Process Payment</button>
    </form>
    
    <div style="text-align: center; margin-top: 1rem;">
        <a href="{% url 'loan_detail' loan.id %}">Back to Loan Details</a> | 
        <a href="{% url 'loan_list' %}">My Loans</a>
    </div>
</div>

<script>
    function setAmount(amount) {
        const maxAmount = {{ remaining_balance|floatformat:2 }};
        const actualAmount = Math.min(amount, maxAmount);
        document.getElementById('amount_paid').value = actualAmount.toFixed(2);
        updatePaymentInfo();
    }
    
    function updatePaymentInfo() {
        const amount = parseFloat(document.getElementById('amount_paid').value) || 0;
        const remaining = {{ remaining_balance|floatformat:2 }};
        const newBalance = Math.max(0, remaining - amount);
        
        document.getElementById('new-balance').innerHTML = 
            `After this payment, your remaining balance will be: <strong>$${newBalance.toFixed(2)}</strong>`;
    }
    
    document.getElementById('amount_paid').addEventListener('input', updatePaymentInfo);
</script>

<div id="new-balance" style="text-align: center; margin-top: 1rem; color: #2c3e50; font-size: 1.1rem;"></div>
{% endblock %}